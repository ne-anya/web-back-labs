{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 8{% endblock %}
{% block style_lab %}<link rel="stylesheet" href="{{ url_for('static', filename='lab8.css')}}">{% endblock %}

{% block main %}
<div class="lab8-container">
    <h1 class="lab8-title">–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏</h1>
    <p class="lab8-subtitle">–°—Ç–∞—Ç—å–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</p>
    
    {% if current_user.is_authenticated %}
        <div style="margin-bottom: 20px; text-align: center;">
            <p style="color: rgb(114, 18, 106);">
                –í—ã –≤–æ—à–ª–∏ –∫–∞–∫: <strong>{{ current_user.login }}</strong>
            </p>
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
                <a class="lab8-link" href="/lab8/articles/">–ú–æ–∏ —Å—Ç–∞—Ç—å–∏</a>
                <a class="lab8-link" href="/lab8/create/">–°–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a>
            </div>
        </div>
    {% else %}
        <div style="margin-bottom: 20px; text-align: center;">
            <p style="color: #666;">
                –í—ã –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏. 
                <a href="/lab8/login/" style="color: rgb(133, 14, 89);">–í–æ–π–¥–∏—Ç–µ</a> –∏–ª–∏ 
                <a href="/lab8/register/" style="color: rgb(133, 14, 89);">–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å</a>, 
                —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Å—Ç–∞—Ç—å–∏.
            </p>
        </div>
    {% endif %}
    
    {% if articles %}
        <div class="articles-list">
            {% for article in articles %}
                <div class="article-card" style="
                    background: white;
                    border-radius: 15px;
                    padding: 20px;
                    margin-bottom: 20px;
                    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                    text-align: left;
                    border-left: 5px solid rgb(133, 14, 89);
                ">
                    <h3 style="color: rgb(133, 14, 89); margin-top: 0;">
                        {{ article.title }}
                        {% if article.is_favorite %}
                            <span style="color: gold; font-size: 18px;">‚≠ê</span>
                        {% endif %}
                    </h3>
                    
                    <div style="color: #666; font-size: 14px; margin-bottom: 10px;">
                        {% if current_user.is_authenticated and article.login_id == current_user.id %}
                            <span style="color: green; font-weight: bold;">üë§ –í–∞—à–∞ —Å—Ç–∞—Ç—å—è</span>
                        {% else %}
                            <span style="color: #666;">üë§ –ê–≤—Ç–æ—Ä: ID {{ article.login_id }}</span>
                        {% endif %}
                    </div>
                    
                    <p style="color: #333; margin: 10px 0; line-height: 1.5;">
                        {{ article.article_title[:300] }}{% if article.article_title|length > 300 %}...{% endif %}
                    </p>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <div style="color: #666; font-size: 14px;">
                            <span style="margin-right: 15px;">
                                {{ article.likes }} –ª–∞–π–∫–æ–≤
                            </span>
                            <span style="color: green; font-weight: bold;">
                                –ü—É–±–ª–∏—á–Ω–∞—è
                            </span>
                        </div>
                        
                        <div>
                            {% if current_user.is_authenticated and article.login_id == current_user.id %}
                                <a class="lab8-link" href="/lab8/edit/{{ article.id }}/" 
                                   style="padding: 5px 15px; font-size: 14px;">
                                    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                                </a>
                            {% endif %}
                            
                            {% if current_user.is_authenticated %}
                                <button class="lab8-link like-button" 
                                        data-article-id="{{ article.id }}"
                                        style="padding: 5px 15px; font-size: 14px; margin-left: 10px;">
                                    –õ–∞–π–∫
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 40px;">
            <p style="font-size: 18px; color: #666;">–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –ø–æ–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
            {% if current_user.is_authenticated %}
                <p style="color: #888; margin-top: 10px;">
                    –í—ã –º–æ–∂–µ—Ç–µ <a href="/lab8/create/" style="color: rgb(133, 14, 89);">—Å–æ–∑–¥–∞—Ç—å —Å—Ç–∞—Ç—å—é</a> 
                    –∏ —Å–¥–µ–ª–∞—Ç—å –µ–µ –ø—É–±–ª–∏—á–Ω–æ–π.
                </p>
            {% endif %}
        </div>
    {% endif %}
    
    <div style="margin-top: 30px; text-align: center;">
        {% if current_user.is_authenticated %}
            <a class="lab8-link" href="/lab8/">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a class="lab8-link" href="/lab8/articles/" style="margin-left: 10px;">–ö –º–æ–∏–º —Å—Ç–∞—Ç—å—è–º</a>
        {% else %}
            <a class="lab8-link" href="/lab8/">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a class="lab8-link" href="/lab8/login/" style="margin-left: 10px;">–í–æ–π—Ç–∏</a>
            <a class="lab8-link" href="/lab8/register/" style="margin-left: 10px;">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
        {% endif %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.like-button').forEach(button => {
        button.addEventListener('click', function() {
            const articleId = this.getAttribute('data-article-id');
            likeArticle(articleId, this);
        });
    });
});

function likeArticle(articleId, buttonElement) {
    fetch(`/lab8/like/${articleId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const likesElement = buttonElement.closest('.article-card')
                .querySelector('span:first-child');
            const currentLikes = parseInt(likesElement.textContent.match(/\d+/)[0]);
            likesElement.textContent = `${currentLikes + 1} –ª–∞–π–∫–æ–≤`;
            
            buttonElement.textContent = '–õ–∞–π–∫–Ω—É—Ç–æ!';
            buttonElement.style.backgroundColor = '#ffcdd2';
            buttonElement.disabled = true;
            
            buttonElement.style.transform = 'scale(1.1)';
            setTimeout(() => {
                buttonElement.style.transform = 'scale(1)';
            }, 300);
        } else {
            alert('–û—à–∏–±–∫–∞: ' + data.error);
        }
    })
    .catch(error => {
        alert('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error);
    });
}
</script>
{% endblock %}